<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 포스터 생성기 (K-드라마 컨셉)</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background-color: #f4f4f9; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        input[type="text"] { padding: 10px; width: 70%; margin-right: 10px; border: 1px solid #ccc; border-radius: 5px; }
        button { padding: 10px 20px; background-color: #E74C3C; color: white; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #C0392B; }
        #status-text { margin-top: 20px; font-weight: bold; color: #34495E; }
        #result-image { max-width: 100%; margin-top: 30px; border: 2px solid #333; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>✨ 나만의 K-드라마 포스터 만들기</h1>
        <p>당신의 컨셉 키워드를 입력하고, AI가 만들어주는 시네마틱 포스터를 받아보세요!</p>
        
        <input type="text" id="keyword-input" placeholder="예: 첫사랑, 눈 내리는 서울, 가을 코트" value="첫사랑, 눈 내리는 서울, 가을 코트" />
        <button onclick="generatePoster()">포스터 생성 시작</button>
        
        <div id="status-text">키워드를 입력하고 버튼을 눌러주세요.</div>
        
        <img id="result-image" src="" alt="AI 생성 포스터" />
    </div>

    <script>
        async function generatePoster() {
            const keywordInput = document.getElementById('keyword-input');
            const resultImage = document.getElementById('result-image');
            const statusText = document.getElementById('status-text');
            
            statusText.textContent = '포스터 생성 중... (AI 연산으로 인해 10-30초 소요될 수 있습니다.)';
            resultImage.src = ''; // 이미지 초기화
            resultImage.style.display = 'none'; // 이미지 숨김
            
            const keyword = keywordInput.value;
            if (!keyword) {
                statusText.textContent = '키워드를 입력해 주세요.';
                return;
            }

            try {
                // Pages Function 엔드포인트 호출
                const response = await fetch('/api/generate-poster', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ keyword: keyword })
                });

                const data = await response.json();

                if (response.ok && data.status === 'success') {
                    // Base64 이미지를 이미지 태그의 src에 할당하여 표시
                    resultImage.src = `data:image/jpeg;base64,${data.image_data}`;
                    resultImage.style.display = 'block';
                    statusText.textContent = '✅ 포스터 생성 완료! 이미지를 캡처하여 공유하세요!';
                } else {
                    // 에러 응답 처리
                    statusText.textContent = `❌ 에러 발생: ${data.error || '알 수 없는 오류'}`;
                }
            } catch (error) {
                statusText.textContent = `⚠️ 네트워크 오류가 발생했습니다: ${error.message}`;
                console.error("API Call Error:", error);
            }
        }
    </script>
</body>
</html>